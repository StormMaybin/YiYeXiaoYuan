/** * Created by p on 2016/11/14. */$(function(){	var $self;    var addperson = function (num, $this1) {        for (var i = 0; i < num; i++) {            $this1.find('.information-people>span:eq(' + i + ')').addClass(                'glyphicon glyphicon-user');        }    };// 添加拼车总人数    var addcolor = function (num, $this1) {        for (var i = 0; i < num; i++) {            $this1.find('.information-people>span:eq(' + i + ')').addClass(                'add-color');        }    };//  添加加入人数	var uid= window.sessionStorage.getItem('userId')			$.ajax({				type:"post",				url:"servlet/QueryUserInfoServlet",				dataType:'json',				data:{					'uId':uid				},				success:function(data){					var appendData="";									if(data.status==0){									}else{					for(var i=0;i<data.length;++i){						var template1=							'<li>'+						'<div class="one-information">'+							'<div class="overlay"></div>'+							'<div class="information-time">'+								'<span>时间:</span>'+								'<span id="peo1-date" class="time-date startTime_date">'+data[i].startDate+'</span>'+								'<span id="peo1-time" class="time-time startTime_time">'+data[i].startTime+'</span>'+							'</div>'+							'<div class="information-where">'+								'<span>出发:'+								'<span class="where-start startPos">西电南校区</span>'+								'</span>'+								'<span class="where-end">到达:</span>'+								'<span class="where-finish arrivePos">'+data[i].arrive+'</span>'+							'</div>'+							'<div class="love-pinche">'+								'<span>真爱校园大巴群:<b>136777985</b></span>'+								'<span>注意事项:</span>'+								'<span class="love-1">&emsp;&emsp;&emsp;&emsp;请等待送票员上门送票</span>'+								'<span class="love-2">&emsp;&emsp;&emsp;&emsp;提前半小时到达上车点</span>'+							'</div>'+						'</div>'+						'</li>';						appendData+=template1;					}					}					$('#list-information').append(appendData);				}			});			$.ajax({				type:"post",				url:"servlet/MInformationServlet",				data:{'id':uid},				dataType:'json',				success:function(data){					var carData=data;					if(data.status==0){						 $('#start_txt').html('千里之行始于足下，快来添加新的拼车吧~')					}else{					for(var i=0;i<data.length;++i){						$('#list-information').append(							'<li>'+								'<div class="one-information">'+									'<div class="overlay"></div>'+									'<div class="information-time">'+										'<span>时间:</span>'+										'<span id="peo1-date" class="time-date startTime_date">'+carData[i].startDate+'</span>'+										'<span id="peo1-time" class="time-time startTime_time">'+ carData[i].startTime_min_hour																		+ ':'																		+ carData[i].startTime_min_min																		+ '-'																		+ carData[i].startTime_max_hour																		+ ':'																		+ carData[i].startTime_max_min+'</span>'+									'</div>'+									'<div class="information-where">'+										'<span>出发:'+										'<span class="where-start startPos">西电南校区</span>'+										'</span>'+										'<span class="where-end">到达:</span>'+										'<span class="where-finish arrivePos">咸阳国际机场</span>'+									'</div>'+									'<div class="information-people">'+										'<span class=""></span>'+										'<span class=""></span>'+										'<span class=""></span>'+										'<span class=""></span>'+										'<span class=""></span>'+                            			'<span class=""></span>'+										'<span class="people-number">上限<p class="maxMember" style="display: inline;">'+carData[i].maxMember+'</p>人，已有<p class="curtMember"  style="display: inline;">'+data[i].curtMember+'</p>人</span>'+									'</div>'+									'<div class="information-remark">'+										'<span>备注:</span>'+										'<span class="remark-content message">'+carData[i].message+'</span>'+									'</div>'+									'<div class="information-issue">'+										'发布于<span class="issue-date pubtime">'+carData[i].pubTime+'</span>'+									'</div>'+										'<a  role="button" class="issue-btn btn  btn-quxiao">取消</a>'+										'<a  role="button" class="issue-btn btn  btn-see">查看联系方式<p  id="carId" hidden>' + carData[i].id + '</p></a>'+										'<a href="fankui.html" role="button" class="issue-btn btn  btn-fankui">反馈</a>'+									'</div>'+								'<div class="peoTel">'+									'<ul class="list-unstyled" id="passenger_num">'+//										'<li>'+//											'<span class="glyphicon glyphicon-user people-applied"></span>'+//											'<p id="pelTel-id">'+data[i].发起者id+'</p>'+//											'<p>手机:&nbsp;<span id="pelTel-tel">'+data[i].发起者tel+'</span></p>'+//											'<p>QQ:&nbsp;<span id="pelTel-qq">'+data[i].发起者QQ+'</span></p>'+//										'</li><!--发起者-->'+									'</ul>'+								'</div>'+							'</li>');						var m=i+1;							$self=$('.sample li:eq('+m+')');							addperson(carData[i].maxMember,$self);							addcolor(carData[i].curtMember,$self);						}					}										$(".btn-see").on('click tap',function () {			        	var carId=$(this).find('p').text();			        	var that=$(this);						var appendData="";			        	$.ajax({			        		type:'post',			        		url:'servlet/QueryUserServlet',			        		dataType:'json',			        		data:{			        			  'iId':carId			        			},			        		success:function(data){			        			for(var i=0;i<data.length;++i){			        				var userData=			        	        		'<li>'+			        						'<p>'+data[i].userName+'</p>'+			        						'<p>手机:&nbsp;<span>'+data[i].mobile+'</span></p>'+			        						'<p>QQ:&nbsp;<span>'+data[i].qq+'</span></p>'+			        					'</li>';									appendData+=userData;									}			        			that.parent("div").next("div").find("ul").html(appendData);			        			that.parent("div").next("div").slideToggle(300);			        		},			        		error:function(){			        			alert('出问题了');			        		}			        	});		                });//下拉显示联系人							             $('.btn-quxiao').on('click tap',function(){		            	 var carId=$(this).next().find('p').text();			            	 var that=$(this);		             	$('#dialog-confirm').fadeIn(300);		             	$(".dialog-btn a:eq(0)").on('click tap', function() {							$("#dialog-confirm").css("display", "none");							var enlist_error = function() {								$('#dialog-error').fadeIn(300);								setTimeout(function() {									$('#dialog-error').fadeOut(300);								}, 2000);							};// 不合报名规则							var enlist_success = function() {								$('#dialog-success').fadeIn(300);								setTimeout(function() {									$('#dialog-success').fadeOut(300);								}, 2000);							};// 报名成功提示		            	$.ajax({		            		type:'post',		            		url:'servlet/CancelInformationServlet',		            		dataType:'json',		            		data:{		            			'uId':uid,			        			 'iId':carId		            		},		            		success:function(data){		            			if (data.status==1){			            			that.parents("li").remove();			            			enlist_success(); 		            			}else if(data.status==0){		            				enlist_error();		            				}		            		}			            	})		            });               		             });   				},				error:function(){				}			});										                       var arr1=$("#list-information").children("li");                arr1.each(function(index){                    var that=$(this);                    var timerDate=that.find("span.time-date").text();                    var timerTime=that.find("span.time-time").text().split("-",2);                    timerDate = timerDate.replace(new RegExp("-","gm"),"/");                    timerDate =(new Date(timerDate)).getTime();                    timerTime[0] =timerTime[0].split(":",2);                    var	timermiao=timerTime[0][0]*60*60*1000+timerTime[0][1]*60*1000;                    timermiao= timermiao+timerDate;                    var timer=new Date();                    timer=timer.getTime();                    if(timer>timermiao)                    {                        that.find('.btn-see').remove();                        that.find('.btn-quxiao').remove();                        that.find('.btn-fankui').css("display","block");                        that.find('.overlay').css("display","block");                    }                });//判断是否是已完成的拼车//  $.ajax({//      method:'post',//      url:'',//      dataType:'json',//      data:{//          //usr.id//      },//      success:function (data) {//          var $box=$('.list-unstyled >li:eq(0)');//          var $container=$('.sample');//          var clone=function(num){//              for(var i=0;i<num;i++){//                  $container.append($box.clone());//              }//          };//          if(data>=1){//              clone(data-1);//克隆n-1个容器//          }else{//              $box.remove();//              $('#start_txt').html('千里之行始于足下，快来添加新的拼车吧~');//          }//      },//      error:function () {//          console.log('Net Wrong');//          var $box=$('.list-unstyled >li:eq(0)');//          $box.remove();//          $('#start_txt').html('千里之行始于足下，快来添加新的拼车吧~');//      }//  });//请求拿到数据});