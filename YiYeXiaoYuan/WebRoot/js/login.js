/** * Created by p on 2016/11/12. *//** * Created by p on 2016/11/10. */$(function () {    $('#login-submit').on('tap click',function (e) {        e.preventDefault();        var that=$(this);        var $number=$('#number').val();        var $password=$('#password').val();        var $validate_num=$("#validate_num").val();        var show_rsp_window=function (selector) {            $(selector).fadeIn(300);            setTimeout(function () {                $(selector).fadeOut(300);                that.attr('disabled','disabled');            },500);        };        var show_rsp_txt=function () {            $('#login_rsp').slideDown(300);            setTimeout(function () {            	that.attr('disabled','disabled');                $('#login_rsp').slideUp(300);            },500);        };//登陆验证后的文本响应        var test_password=function (wrd) {            if (wrd.length>=6&&wrd.length<=12) {                return 1;            }            else {                return 0;            }        };//验证密码是否符合长度要求        var test_number=function (num) {            var reg=/[0-9]{11}/;            if (reg.test(num)==true){                return 1;            }            else{                return 0;            }        };//匹配电话号码 t1 f0        if(test_number($number)==1){            if(test_password($password)==1){                if($validate_num!=img_validate.img[x1].id){                    $('#login_rsp_txt').html('验证码输入错误');                    show_rsp_txt();                }                else{                    $.ajax({                    method:"post",                    url:'servlet/LoginServlet',                    dataType:'json',                    data:{                        'mobile':$number,                        'passWord':$password                    },                    success:function (data) {                        //0  有id，但密码错误                        //1  成功                        //-1  无id                        if(data.status==1){                            $('#dialog-success').fadeIn(300);                            setTimeout(function () {                            	window.sessionStorage.setItem('type',2);                                window.sessionStorage.setItem('userName',data.user.userName);//设置用户名缓存                                window.sessionStorage.setItem('userId',data.user.id);//设置用户id缓存                                window.sessionStorage.setItem('userTel',data.user.mobile);//电话                                window.sessionStorage.setItem('userQQ',data.user.qq);//qq                                window.sessionStorage.setItem('isChange',data.nameChange);//是否修改用户名//                                window.history.go(-1);                                window.location.href="index.html";                            },2000);                        }                        if(data.status==0){                            $('#login_rsp_txt').html('密码错误');                            $('#login_rsp_href').html('立即重置密码').attr('href','getPassword1.html');                            show_rsp_txt()                        }                        if(data.status==-1){                            $('#login_rsp_txt').html('该用户不存在');                            $('#login_rsp_href').html('立即注册').attr('href','注册1.html');                            show_rsp_txt();                        }                    },                    error:function (XHR) {                        alert('Ajax错误码：'+XHR.readyState+' 服务端响应码:'+XHR.status);                    }                });}            }            else{                show_rsp_window('#dialog-wrong_wrd');                return false;            }//密码格式错误        }        else {            show_rsp_window('#dialog-wrong_num');            return false;        }//用户名格式错误    });});