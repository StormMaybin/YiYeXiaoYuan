/** * Created by YZY on 2016/11/4. */$(function(){	function GetDateStr() {		var dd = new Date();		var y = dd.getFullYear();		var m = dd.getMonth() + 1;		if (m < 10) {			m = '0' + m;		}		var d = dd.getDate();		if (d < 10) {			d = '0' + d;		}		return y + "-" + m + "-" + d;	}	var dateToday = GetDateStr();//	alert(dateToday);    var show_overlay=function () {        var overlay = $("<div id='lean_overlay'></div><img id='pointer' src='img/pointer.svg' alt=''/><p id='tip'>为了发布拼车，请点击登录</p>");        $("body").append(overlay);        $('#lean_overlay').on('tap click',function () {            $(this).fadeOut(300);            $('#pointer,#tip').fadeOut(300);        });    };//出现登录提示    var usr_id=window.sessionStorage.getItem('userName');//取id    if(usr_id==null){show_overlay();}    $('#user1').on('tap click',function () {        if(usr_id!=null){            window.location.href='myRoute.html';        }else{            window.location.href='login.html';        }    });//用户头像的点击    $(".fache-replace").on('click tap',function(){        var o1 = $(".fache-start").html();        $(".fache-start").html($(".fache-end").html());        $(".fache-end").html(o1);    });//交换起点终点    var nowTemp = new Date();    var nowDay = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0).valueOf();    var nowAfterDay=nowDay+31*2*24*60*60*1000;    // alert(nowDay+"aaa"+nowAfterDay);    var nowMoth = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), 1, 0, 0, 0, 0).valueOf();    var nowYear = new Date(nowTemp.getFullYear(), 0, 1, 0, 0, 0, 0).valueOf();    var $myStart2 = $('#one-date');    var checkin = $myStart2.datepicker({        theme:"danger",        onRender: function(date, viewMode) {            // 默认 days 视图，与当前日期比较            var viewDate = nowDay;            switch (viewMode) {                // moths 视图，与当前月份比较                case 1:                    viewDate = nowMoth;                    break;                // years 视图，与当前年份比较                case 2:                    viewDate = nowYear;                    break;            }            return date.valueOf() > nowAfterDay ? 'am-disabled' : ''||date.valueOf() < viewDate ? 'am-disabled' : '';        }    });    $('#start_btn').on('click tap', function (e) {        e.preventDefault();     if(usr_id!=null) {//判断是否登陆，此处存的session 是usrName            var message=$('#message').val();            var reg=/[0-9]{5,}/g;            if(reg.test(message)==true){                $('#dialog-check').fadeIn(300);                setTimeout(function () {                    $('#dialog-check').fadeOut(300);                },3000);                return false            }//首先判断备注是否合法            var min_m=$('#startTime_min_min').val();            var min_h=$('#startTime_min_hour').val();            var max_m= $('#startTime_max_min').val();            var max_h=$('#startTime_max_hour').val();            //判断时间的合法            function change_time() {                var t1;                t1=max_h;                max_h=min_h;                min_h=t1;                var t2;                t2=max_m;                max_m=min_m;                min_m=t2;            }            if(max_h>min_h){}            if(max_h<min_h){change_time();}            if(max_h==min_h){                if(max_m>=min_m){}                if(max_m<min_m){change_time();}            }            $('#startTime_min_min').val(min_m);            $('#startTime_min_hour').val(min_h);            $('#startTime_max_min').val(max_m);            $('#startTime_max_hour').val(max_h);            ////正确显示所选时间            if($('#maxMember').val()>6){                $('#dialog-error2').fadeIn(300);                setTimeout(function () {                    $('#dialog-error2').fadeOut(300);                },2000);                return false;            }            if($myStart2.attr('value')==undefined||$('#curtMember').val()==''||$('#maxMember').val()==''||$('#curtMember').val()>=$('#maxMember').val()||                (min_m>=60||min_m<0)||(max_m>=60||max_m<0)||(max_h>=24||max_h<0)||(min_h>=24||min_h<0)) {                $('#dialog-error').fadeIn(300);                setTimeout(function () {                    $('#dialog-error').fadeOut(300);                },2000);                return false;            }            //判断表单填写的完整性            $.ajax({                method: 'post',                url: 'servlet/NewCarServlet',                dataType: 'json',                data: {                    'startDate':$myStart2.attr('value'),                    'startPos': $('#where-start').html(),                    'arrivePos': $('#where-end').html(),                    'startTime_min_hour': min_h,                    'startTime_min_min': min_m,                    'startTime_max_hour': max_h,                    'startTime_max_min': max_m,                    'maxMember': $('#maxMember').val(),                    'curtMember': $('#curtMember').val(),                    'message':message,                    'pubTime':dateToday,                    'userName':window.sessionStorage.getItem('userName')                },                success: function (data) {                	if (data.status==1){                		 $('#dialog-success').fadeIn(300);                         setTimeout(function () {                             $('#dialog-success').fadeOut(300);                             window.location.href='myRoute.html';                         },1000)                	}                	else{                        $('#dialog-fail').fadeIn(300);                        setTimeout(function () {                            $('#dialog-fail').fadeOut(300);                        },1000)                	}                },                error: function (jqXHR) {                    alert('wrong' + jqXHR.status + jqXHR.readyState);                }            });//发送表单数据至后台      	}else if(usr_id==null){            $('#dialog-login').fadeIn(300);            setTimeout(function () {                location.href='login.html';            },2000)        }    });//发布新拼车 按钮事件    $('#where-end').on('click tap',function(){    	$('.information-form-fache').css('display','none');    	$('.chooseDd1').css('display','block');    	$("#set-button1").click(				function(){				var whereEnd=$("#input-where-end").val();				localStorage.setItem("whereEnd",whereEnd);				$('.information-form-fache').css('display','block');    			$('.chooseDd1').css('display','none');    			var bbb=localStorage.getItem("whereEnd");				if(!bbb=="")				{					$("#where-end").html(bbb);				};				$("#input-where-end").val('');			});			var arr=$(".choose-where1").children("div");			var cc= new Array;			    arr.each(function(index){			 		$(this).last().click(		  	 			function(){		 			 		cc[index]=$(this).text();		 			 		localStorage.setItem("whereEnd",cc[index]);		 			 		$('.information-form-fache').css('display','block');    						$('.chooseDd1').css('display','none');    						var bbb=localStorage.getItem("whereEnd");						    if(!bbb=="")						    {						        $("#where-end").html(bbb);						    };    								 			 		//console.log(bb[index])		 			})			 		})    });    $('#where-start').on('click tap',function(){    	$('.information-form-fache').css('display','none');    	$('.chooseDd2').css('display','block');    	$("#set-button2").click(				function(){				var whereStart=$("#input-where-start").val();				localStorage.setItem("whereStart",whereStart);				$('.information-form-fache').css('display','block');    			$('.chooseDd2').css('display','none');    			var aaa=localStorage.getItem("whereStart");    			if(!aaa=="")				{					$("#where-start").html(aaa);				}				$("#input-where-start").val('');			});			var arr2=$(".choose-where2").children("div");			var dd= new Array;			    arr2.each(function(index){			 		$(this).last().click(		  	 			function(){		 			 		dd[index]=$(this).text();		 			 		localStorage.setItem("whereStart",dd[index]);		 			 		$('.information-form-fache').css('display','block');    						$('.chooseDd2').css('display','none');    						var aaa=localStorage.getItem("whereStart");    						if(!aaa=="")							{							    $("#where-start").html(aaa);							};		 			});			 		});    });});